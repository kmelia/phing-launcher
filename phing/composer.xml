<?xml version="1.0" encoding="UTF-8"?>
<project>
    <target name="composer.install">
        <phingcall target="composer.install-or-update">
            <property name="composer.command" value="install" />
        </phingcall>
    </target>
    
    <target name="composer.update">
        <phingcall target="composer.install-or-update">
            <property name="composer.command" value="update" />
        </phingcall>
    </target>
    
    <target name="composer.install-or-update" depends="composer.check-parameters, composer.get-latest" hidden="true">
        <exec command="php composer.phar ${composer.command} --prefer-dist ${composer.parameters}" passthru="true" level="info" />
    </target>
    
    <target name="composer.check-parameters" hidden="true">
        <if>
            <not>
                <isset property="composer.parameters" />
            </not>
            <then>
                <property name="composer.parameters" value="" />
            </then>
        </if>
    </target>
    
    <target name="composer.get-latest" hidden="true">
        <if>
            <available file="composer.phar" type="file" />
            <then>
                <phingcall target="composer.self-update" />
            </then>
            <else>
                <phingcall target="composer.download-from-origin" />
            </else>
        </if>
    </target>
    
    <target name="composer.download-from-origin" hidden="true">
        <exec command="curl -s http://getcomposer.org/installer | php" passthru="true" level="info" />
    </target>
    
    <target name="composer.self-update" hidden="true">
        <exec command="php composer.phar self-update" passthru="true" level="info" />
    </target>
</project>