<?xml version="1.0" encoding="UTF-8"?>
<project>
    <target name="composer.install">
        <phingcall target="composer.install-or-update">
            <property name="composer.command" value="install" />
        </phingcall>
    </target>
    
    <target name="composer.update">
        <phingcall target="composer.install-or-update">
            <property name="composer.command" value="update" />
        </phingcall>
    </target>
    
    <target name="composer.install-or-update" depends="composer.check-properties, composer.get-latest" hidden="true">
        <phingcall target="phing.run-command">
            <property name="phing.command-name" value="php composer.phar ${composer.command} --working-dir=${composer.directory} --prefer-dist ${composer.parameters}" />
        </phingcall>
    </target>
    
    <target name="composer.check-properties" hidden="true">
        <if>
            <not>
                <isset property="composer.parameters" />
            </not>
            <then>
                <property name="composer.parameters" value="" />
            </then>
        </if>
        
        <if>
            <not>
                <isset property="composer.directory" />
            </not>
            <then>
                <property name="composer.directory" value="." />
            </then>
        </if>
    </target>
    
    <target name="composer.get-latest" hidden="true">
        <if>
            <available file="composer.phar" type="file" />
            <then>
                <phingcall target="composer.self-update" />
            </then>
            <else>
                <phingcall target="composer.download-from-origin" />
            </else>
        </if>
    </target>
    
    <target name="composer.download-from-origin" hidden="true">
        <phingcall target="phing.run-command">
            <property name="phing.command-name" value="curl -sS http://getcomposer.org/installer | php" />
        </phingcall>
    </target>
    
    <target name="composer.self-update" hidden="true">
        <phingcall target="phing.run-command">
            <property name="phing.command-name" value="php composer.phar self-update" />
        </phingcall>
    </target>
</project>
